'use strict';
'require rpc';
'require baseclass';

return baseclass.extend({
	callStatus: rpc.declare({
		object: 'luci.cve-triage',
		method: 'status',
		expect: {}
	}),

	callGetPending: rpc.declare({
		object: 'luci.cve-triage',
		method: 'get_pending',
		expect: {}
	}),

	callGetAlerts: rpc.declare({
		object: 'luci.cve-triage',
		method: 'get_alerts',
		expect: {}
	}),

	callGetRecommendations: rpc.declare({
		object: 'luci.cve-triage',
		method: 'get_recommendations',
		params: ['limit'],
		expect: {}
	}),

	callGetSummary: rpc.declare({
		object: 'luci.cve-triage',
		method: 'get_summary',
		expect: {}
	}),

	callRun: rpc.declare({
		object: 'luci.cve-triage',
		method: 'run',
		expect: {}
	}),

	callApprove: rpc.declare({
		object: 'luci.cve-triage',
		method: 'approve',
		params: ['id'],
		expect: {}
	}),

	callReject: rpc.declare({
		object: 'luci.cve-triage',
		method: 'reject',
		params: ['id', 'reason'],
		expect: {}
	}),

	callApproveAll: rpc.declare({
		object: 'luci.cve-triage',
		method: 'approve_all',
		expect: {}
	}),

	callClearPending: rpc.declare({
		object: 'luci.cve-triage',
		method: 'clear_pending',
		expect: {}
	}),

	callAckAlert: rpc.declare({
		object: 'luci.cve-triage',
		method: 'ack_alert',
		params: ['id'],
		expect: {}
	}),

	getSeverityClass: function(severity) {
		switch (severity) {
			case 'critical': return 'danger';
			case 'high': return 'warning';
			case 'medium': return 'primary';
			default: return 'secondary';
		}
	},

	getSeverityIcon: function(severity) {
		switch (severity) {
			case 'critical': return '\u26A0';
			case 'high': return '\u2757';
			case 'medium': return '\u2139';
			default: return '\u2022';
		}
	},

	formatCVE: function(cve) {
		return E('a', {
			'href': 'https://nvd.nist.gov/vuln/detail/' + cve,
			'target': '_blank',
			'class': 'cve-link'
		}, cve);
	}
});
